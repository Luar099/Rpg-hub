<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Timão + Bússola Interativos</title>
  <style>
    :root{
      --bg1:#050813;
      --bg2:#0b1b2c;

      --wood1:#7a4a20;
      --wood2:#5a3414;

      --metal1:#d7dde6;
      --metal2:#8893a3;

      --shadow: rgba(0,0,0,.45);
      --glow: rgba(120,190,255,.35);

      --panel: rgba(0,0,0,.22);
      --line: rgba(255,255,255,.10);
      --txt:#e9f1ff;
      --muted: rgba(233,241,255,.72);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      display:grid;
      place-items:center;
      background:
        radial-gradient(900px 700px at 50% 35%, rgba(70,130,180,.25), transparent 60%),
        radial-gradient(1000px 800px at 50% 70%, rgba(0,255,200,.08), transparent 60%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      user-select:none;
    }

    .layout{
      width:min(980px, 94vw);
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 18px;
      align-items:center;
    }

    .card{
      position:relative;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      overflow:hidden;
      padding: 18px;
      backdrop-filter: blur(8px);
    }

    .title{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: 10px;
      margin: 2px 2px 12px;
    }
    .title h1{
      font-size: 16px;
      margin:0;
      letter-spacing:.3px;
      opacity:.95;
      font-weight: 650;
    }
    .title span{
      font-size: 13px;
      color: var(--muted);
    }

    /* palco do timão */
    .stage{
      width: 100%;
      aspect-ratio: 1 / 1;
      display:grid;
      place-items:center;
      perspective: 900px;
      position:relative;
      border-radius: 18px;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .spot{
      position:absolute;
      inset:-120px;
      background: radial-gradient(240px 240px at var(--mx,50%) var(--my,50%), var(--glow), transparent 60%);
      filter: blur(6px);
      pointer-events:none;
      opacity:.9;
    }

    .wheel{
      width: 78%;
      aspect-ratio: 1/1;
      position:relative;
      transform-style: preserve-3d;
      transform:
        rotateX(var(--tiltX,0deg))
        rotateY(var(--tiltY,0deg))
        rotateZ(var(--spin,0deg));
      transition: transform 90ms linear;
      filter: drop-shadow(0 18px 28px var(--shadow));
    }

    .ring{
      position:absolute;
      inset: 10%;
      border-radius:50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 40%),
        radial-gradient(circle at 70% 70%, rgba(0,0,0,.22), transparent 45%),
        conic-gradient(from 20deg,
          #6b3d18 0 14%,
          #875023 14% 28%,
          #6b3d18 28% 42%,
          #875023 42% 56%,
          #6b3d18 56% 70%,
          #875023 70% 84%,
          #6b3d18 84% 100%);
      box-shadow:
        inset 0 0 0 14px rgba(0,0,0,.15),
        inset 0 0 0 2px rgba(255,255,255,.12),
        0 0 0 1px rgba(255,255,255,.08);
    }
    .ring::after{
      content:"";
      position:absolute;
      inset: -7%;
      border-radius:50%;
      background: radial-gradient(circle at 50% 50%, transparent 62%, rgba(0,0,0,.35) 78%, transparent 79%);
      opacity:.55;
      pointer-events:none;
    }

    .hub{
      position:absolute;
      inset: 38%;
      border-radius:50%;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.75), rgba(255,255,255,.0) 42%),
        radial-gradient(circle at 70% 75%, rgba(0,0,0,.35), transparent 45%),
        linear-gradient(180deg, var(--metal1), var(--metal2));
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.25),
        inset 0 -8px 18px rgba(0,0,0,.25);
    }
    .hub::before{
      content:"";
      position:absolute;
      inset: 18%;
      border-radius:50%;
      background: radial-gradient(circle at 35% 30%, rgba(255,255,255,.85), rgba(255,255,255,.1) 55%, rgba(0,0,0,.2));
      opacity:.9;
    }

    .bolt{
      position:absolute;
      width:10%;
      aspect-ratio:1/1;
      border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,.1) 45%, rgba(0,0,0,.35));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
      top: 17%;
      left: 45%;
      transform: translate(-50%,-50%);
      opacity:.9;
    }
    .bolt.b2{ top: 50%; left: 17%; }
    .bolt.b3{ top: 83%; left: 45%; }
    .bolt.b4{ top: 50%; left: 83%; }

    .spoke{
      position:absolute;
      left:50%;
      top:50%;
      width: 10%;
      height: 38%;
      transform-origin: 50% 90%;
      transform: translate(-50%,-90%) rotate(var(--a));
    }
    .spoke .wood{
      position:absolute;
      inset:0;
      border-radius: 999px;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.18), transparent 40%),
        linear-gradient(180deg, var(--wood1), var(--wood2));
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.10),
        inset 0 -10px 14px rgba(0,0,0,.18);
    }
    .spoke .knob{
      position:absolute;
      left:50%;
      top:-6%;
      width: 165%;
      aspect-ratio: 1/1;
      transform: translate(-50%,-35%);
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 45%),
        linear-gradient(180deg, #8b572a, #4a2b10);
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.10),
        0 10px 18px rgba(0,0,0,.35);
    }

    .wheel.press{
      transition: transform 60ms linear;
      filter: drop-shadow(0 14px 24px var(--shadow));
    }

    /* BÚSSOLA */
    .compassWrap{
      display:grid;
      gap: 14px;
    }
    .compassStage{
      position:relative;
      width:100%;
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      background: var(--panel);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
      display:grid;
      place-items:center;
      perspective: 900px;
    }

    .compass{
      width: 78%;
      aspect-ratio: 1/1;
      border-radius:50%;
      position:relative;
      transform-style: preserve-3d;
      transform: rotateX(var(--ctiltX,0deg)) rotateY(var(--ctiltY,0deg));
      transition: transform 90ms linear;
      filter: drop-shadow(0 18px 28px rgba(0,0,0,.42));
    }

    .c-face{
      position:absolute;
      inset:0;
      border-radius:50%;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.20), transparent 45%),
        radial-gradient(circle at 70% 75%, rgba(0,0,0,.32), transparent 45%),
        linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: inset 0 0 0 10px rgba(0,0,0,.20);
    }

    /* anel com marcações */
    .c-ring{
      position:absolute;
      inset: 9%;
      border-radius: 50%;
      background:
        radial-gradient(circle at 50% 50%, rgba(0,0,0,.18), transparent 65%),
        conic-gradient(from 0deg,
          rgba(255,255,255,.0) 0 2deg, rgba(255,255,255,.16) 2deg 3deg,
          rgba(255,255,255,.0) 3deg 12deg, rgba(255,255,255,.12) 12deg 13deg,
          rgba(255,255,255,.0) 13deg 22deg, rgba(255,255,255,.12) 22deg 23deg,
          rgba(255,255,255,.0) 23deg 32deg, rgba(255,255,255,.12) 32deg 33deg,
          rgba(255,255,255,.0) 33deg 42deg, rgba(255,255,255,.12) 42deg 43deg,
          rgba(255,255,255,.0) 43deg 52deg, rgba(255,255,255,.16) 52deg 53deg,
          rgba(255,255,255,.0) 53deg 360deg);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.06);
      opacity:.95;
    }

    /* letras N E S W */
    .dir{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%,-50%) rotate(var(--rot));
      width: 100%;
      height: 100%;
      pointer-events:none;
    }
    .dir span{
      position:absolute;
      left:50%;
      top: 6%;
      transform: translateX(-50%);
      font-weight: 800;
      letter-spacing: .8px;
      font-size: 16px;
      color: rgba(233,241,255,.82);
      text-shadow: 0 6px 18px rgba(0,0,0,.45);
    }
    .dir .n{ color: rgba(255,120,120,.92); } /* Norte em vermelho */

    /* agulha */
    .needle{
      position:absolute;
      inset: 17%;
      border-radius: 50%;
      display:grid;
      place-items:center;
      transform: rotate(var(--heading,0deg));
      transition: transform 90ms linear;
      transform-origin: 50% 50%;
    }
    .needle::before{
      /* ponta Norte */
      content:"";
      position:absolute;
      left:50%;
      top: 5%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 110px solid rgba(255,90,90,.95);
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.35));
    }
    .needle::after{
      /* ponta Sul */
      content:"";
      position:absolute;
      left:50%;
      bottom: 5%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 110px solid rgba(190,210,255,.85);
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.35));
    }

    .c-center{
      position:absolute;
      inset: 42%;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,.1) 55%, rgba(0,0,0,.25));
      box-shadow:
        inset 0 0 0 2px rgba(255,255,255,.22),
        0 10px 18px rgba(0,0,0,.35);
      z-index: 5;
    }

    /* painel de leitura */
    .readout{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding: 12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(233,241,255,.88);
      font-size: 13px;
    }
    .readout b{
      font-size: 14px;
      letter-spacing: .3px;
      color: rgba(233,241,255,.95);
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: rgba(233,241,255,.82);
      white-space:nowrap;
    }

    .waves{
      position:fixed;
      inset:auto 0 -60px 0;
      height:220px;
      background:
        radial-gradient(220px 60px at 15% 40%, rgba(255,255,255,.07), transparent 70%),
        radial-gradient(240px 60px at 55% 60%, rgba(255,255,255,.06), transparent 70%),
        radial-gradient(240px 60px at 85% 35%, rgba(255,255,255,.05), transparent 70%),
        linear-gradient(180deg, transparent, rgba(0,0,0,.25));
      opacity:.8;
      pointer-events:none;
    }

    @media (max-width: 860px){
      .layout{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- TIMÃO -->
    <div class="card">
      <div class="title">
        <h1>Timão</h1>
        <span>arraste para girar • duplo clique reseta</span>
      </div>
      <div class="stage" id="stage">
        <div class="spot" id="spot"></div>
        <div class="wheel" id="wheel" aria-label="Timão interativo">
          <div class="ring"></div>

          <div class="spoke" style="--a:0deg"><div class="wood"></div><div class="knob"></div></div>
          <div class="spoke" style="--a:45deg"><div class="wood"></div><div class="knob"></div></div>
          <div class="spoke" style="--a:90deg"><div class="wood"></div><div class="knob"></div></div>
          <div class="spoke" style="--a:135deg"><div class="wood"></div><div class="knob"></div></div>
          <div class="spoke" style="--a:180deg"><div class="wood"></div><div class="knob"></div></div>
          <div class="spoke" style="--a:225deg"><div class="wood"></div><div class="knob"></div></div>
          <div class="spoke" style="--a:270deg"><div class="wood"></div><div class="knob"></div></div>
          <div class="spoke" style="--a:315deg"><div class="wood"></div><div class="knob"></div></div>

          <div class="hub"></div>
          <div class="bolt"></div>
          <div class="bolt b2"></div>
          <div class="bolt b3"></div>
          <div class="bolt b4"></div>
        </div>
      </div>
    </div>

    <!-- BÚSSOLA -->
    <div class="card">
      <div class="title">
        <h1>Bússola</h1>
        <span>aguha acompanha o timão</span>
      </div>

      <div class="compassWrap">
        <div class="compassStage" id="cStage">
          <div class="spot" id="cSpot"></div>

          <div class="compass" id="compass">
            <div class="c-face"></div>
            <div class="c-ring"></div>

            <!-- letras -->
            <div class="dir" style="--rot:0deg"><span class="n">N</span></div>
            <div class="dir" style="--rot:90deg"><span>E</span></div>
            <div class="dir" style="--rot:180deg"><span>S</span></div>
            <div class="dir" style="--rot:270deg"><span>W</span></div>

            <!-- agulha -->
            <div class="needle" id="needle"></div>
            <div class="c-center"></div>
          </div>
        </div>

        <div class="readout">
          <div>
            <div style="opacity:.85">Rumo</div>
            <b id="headingTxt">000°</b>
          </div>
          <div class="kbd">Dica: o rumo muda ao girar o timão</div>
        </div>
      </div>
    </div>
  </div>

  <div class="waves"></div>

  <script>
    // --------- ELEMENTOS ---------
    const stage = document.getElementById("stage");
    const wheel = document.getElementById("wheel");
    const spot  = document.getElementById("spot");

    const cStage = document.getElementById("cStage");
    const compass = document.getElementById("compass");
    const cSpot = document.getElementById("cSpot");
    const needle = document.getElementById("needle");
    const headingTxt = document.getElementById("headingTxt");

    // --------- ESTADO ---------
    let dragging = false;
    let lastX = 0;

    let spin = 0;        // rotação alvo do timão
    let smoothSpin = 0;  // rotação suavizada

    let tiltX = 0, tiltY = 0;
    let ctiltX = 0, ctiltY = 0;

    // Heading (rumo) da bússola em graus
    let heading = 0;
    let smoothHeading = 0;

    const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
    const mod360 = (deg) => ((deg % 360) + 360) % 360;

    function pointerPos(el, clientX, clientY){
      const r = el.getBoundingClientRect();
      const x = (clientX - r.left) / r.width;
      const y = (clientY - r.top) / r.height;
      return { x: clamp(x,0,1), y: clamp(y,0,1) };
    }

    // brilho + tilt timão
    function setWheelLight(mx, my){
      spot.style.setProperty("--mx", (mx*100).toFixed(2) + "%");
      spot.style.setProperty("--my", (my*100).toFixed(2) + "%");

      tiltY = clamp((mx - 0.5) * 18, -10, 10);
      tiltX = clamp(-(my - 0.5) * 18, -10, 10);

      wheel.style.setProperty("--tiltX", tiltX.toFixed(2) + "deg");
      wheel.style.setProperty("--tiltY", tiltY.toFixed(2) + "deg");
    }

    // brilho + tilt bússola
    function setCompassLight(mx, my){
      cSpot.style.setProperty("--mx", (mx*100).toFixed(2) + "%");
      cSpot.style.setProperty("--my", (my*100).toFixed(2) + "%");

      ctiltY = clamp((mx - 0.5) * 14, -8, 8);
      ctiltX = clamp(-(my - 0.5) * 14, -8, 8);

      compass.style.setProperty("--ctiltX", ctiltX.toFixed(2) + "deg");
      compass.style.setProperty("--ctiltY", ctiltY.toFixed(2) + "deg");
    }

    // Timão -> Bússola: quanto o timão gira, quanto o rumo muda.
    // Ajuste o multiplicador para “mexer mais/menos”.
    const HEADING_FACTOR = 0.65; // 1.0 = mesmo giro do timão, 0.65 = mais suave

    function animate(){
      // suaviza rotação do timão
      smoothSpin += (spin - smoothSpin) * 0.14;
      wheel.style.setProperty("--spin", smoothSpin.toFixed(2) + "deg");

      // transforma giro do timão em rumo (0..359)
      heading = mod360(-smoothSpin * HEADING_FACTOR); // negativo pra ficar com “sensação” náutica
      // suaviza agulha
      // para evitar "voltar" quando cruza 0/360, calcula o caminho mais curto:
      let delta = heading - smoothHeading;
      if (delta > 180) delta -= 360;
      if (delta < -180) delta += 360;
      smoothHeading = mod360(smoothHeading + delta * 0.16);

      needle.style.setProperty("--heading", smoothHeading.toFixed(2) + "deg");

      const txt = String(Math.round(smoothHeading)).padStart(3, "0");
      headingTxt.textContent = txt + "°";

      requestAnimationFrame(animate);
    }
    animate();

    // --------- EVENTOS TIMÃO ---------
    stage.addEventListener("mousemove", (e)=>{
      const p = pointerPos(stage, e.clientX, e.clientY);
      setWheelLight(p.x, p.y);

      if(dragging){
        const dx = e.clientX - lastX;
        lastX = e.clientX;
        spin += dx * 0.55; // sensibilidade do giro
      }
    });

    stage.addEventListener("mousedown", (e)=>{
      dragging = true;
      lastX = e.clientX;
      wheel.classList.add("press");
    });

    window.addEventListener("mouseup", ()=>{
      dragging = false;
      wheel.classList.remove("press");
    });

    stage.addEventListener("dblclick", ()=>{
      spin = 0;
    });

    // Mobile timão
    stage.addEventListener("touchstart", (e)=>{
      dragging = true;
      lastX = e.touches[0].clientX;
      wheel.classList.add("press");
    }, {passive:true});

    stage.addEventListener("touchmove", (e)=>{
      const t = e.touches[0];
      const p = pointerPos(stage, t.clientX, t.clientY);
      setWheelLight(p.x, p.y);

      if(dragging){
        const dx = t.clientX - lastX;
        lastX = t.clientX;
        spin += dx * 0.6;
      }
    }, {passive:true});

    window.addEventListener("touchend", ()=>{
      dragging = false;
      wheel.classList.remove("press");
    });

    // --------- EVENTOS BÚSSOLA (só luz/tilt) ---------
    cStage.addEventListener("mousemove", (e)=>{
      const p = pointerPos(cStage, e.clientX, e.clientY);
      setCompassLight(p.x, p.y);
    });
    cStage.addEventListener("touchmove", (e)=>{
      const t = e.touches[0];
      const p = pointerPos(cStage, t.clientX, t.clientY);
      setCompassLight(p.x, p.y);
    }, {passive:true});

    // estados iniciais
    setWheelLight(0.5, 0.5);
    setCompassLight(0.5, 0.5);
  </script>
</body>
</html>
